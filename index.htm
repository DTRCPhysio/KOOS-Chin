<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>膝關節功能問卷（Chinese Short KOOS）</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body { font-family: "Noto Sans TC","Microsoft JhengHei",sans-serif; background:#f5f5f5; margin:0; padding:16px; }
    .container { max-width:900px; margin:auto; background:#fff; padding:20px; border-radius:10px; box-shadow:0 2px 6px rgba(0,0,0,0.1); }
    h1 { text-align:center; margin-bottom:12px; }
    h2 { margin-top:24px; margin-bottom:8px; }
    .question { margin-bottom:16px; padding:10px; border:1px solid #ddd; border-radius:8px; background:#fafafa; }
    .question-title { font-weight:600; margin-bottom:8px; }
    .options { display:flex; flex-wrap:wrap; gap:6px; }
    .option { display:flex; align-items:center; gap:6px; padding:6px 10px; border-radius:6px; background:#fff; border:1px solid #ccc; cursor:pointer; font-size:0.9rem; }
    .option input { cursor:pointer; }
    button { margin-top:20px; padding:12px 20px; border:none; border-radius:6px; background:#1976d2; color:white; font-size:1rem; cursor:pointer; }
    button:hover { background:#125a9c; }
    .modal { display:none; position:fixed; z-index:1000; inset:0; background:rgba(0,0,0,0.4); }
    .modal-content { background:#fff; margin:15% auto; padding:20px; border-radius:10px; width:90%; max-width:420px; text-align:center; box-shadow:0 2px 8px rgba(0,0,0,0.3); }
    .close-btn { margin-top:15px; padding:10px 16px; background:#555; color:white; border:none; border-radius:6px; cursor:pointer; }
    .close-btn:hover { background:#333; }
    .warning { color:#c62828; margin-top:10px; font-size:0.9rem; }
    @media(max-width:600px){ .options{flex-direction:column;} .option{width:100%;} }
  </style>
</head>
<body>

<div class="container">
  <h1>膝關節功能問卷（Chinese Short KOOS）</h1>
  <p>請根據你過去一星期的情況，在每一題中選擇一個最合適的答案。</p>

  <h2>第一部分：疼痛（KOOS-KP）</h2>
  <div id="questions"></div>

  <button onclick="calculateKOOS()">計算分數</button>
  <div id="warning" class="warning"></div>
</div>

<div id="scoreModal" class="modal">
  <div class="modal-content">
    <h2>膝關節問卷結果</h2>
    <p id="kpScore"></p>
    <p id="kpsScore"></p>
    <p id="kqScore"></p>
    <p style="font-size:0.9rem;color:#555;">0 分＝極度問題，100 分＝沒有問題</p>
    <button class="close-btn" onclick="closeModal()">關閉</button>
  </div>
</div>

<script>
const questions = [
  "1. 你多常感到膝痛？",
  "2. 以膝關節為中心扭動或轉動身體",
  "3. 完全伸直膝關節",
  "4. 完全曲膝關節",
  "5. 在平地步行",
  "6. 上或下樓梯",
  "7. 晚上睡",
  "8. 坐下或蹲下",
  "9. 挺直站立",
  "10. 起床",
  "11. 穿襪子／繫鞋",
  "12. 從坐姿站起",
  "13. 轉身至地／在地上撿起物品",
  "14. 轉動／扭動受傷的膝關節",
  "15. 跪下",
  "16. 蹲坐",
  "17. 你多常注意到你的膝關節問題？",
  "18. 你有否改變生活模式避免傷及膝關節？",
  "19. 你是否對膝關節缺乏信心？",
  "20. 膝關節對生活造成多大影響？"
];

const options = [
  ["從不","每月一次","每星期一次","每日一次","經常"],
  ["沒有","輕微","中度","嚴重","極度"]
];

const questionsDiv = document.getElementById("questions");

questions.forEach((text, index) => {
  const qNum = index + 1;
  const qDiv = document.createElement("div");
  qDiv.className = "question";

  const title = document.createElement("div");
  title.className = "question-title";
  title.textContent = text;
  qDiv.appendChild(title);

  const optionsDiv = document.createElement("div");
  optionsDiv.className = "options";

  const optSet = (qNum === 1 || qNum === 17) ? options[0] : options[1];

  optSet.forEach((label, i) => {
    const opt = document.createElement("label");
    opt.className = "option";

    const input = document.createElement("input");
    input.type = "radio";
    input.name = `q${qNum}`;
    input.value = i;

    opt.appendChild(input);
    opt.appendChild(document.createTextNode(label));
    optionsDiv.appendChild(opt);
  });

  qDiv.appendChild(optionsDiv);
  questionsDiv.appendChild(qDiv);
});

function calculateKOOS() {
  const warning = document.getElementById("warning");
  warning.textContent = "";

  let totalKP = 0, totalKPS = 0, totalKQ = 0;
  let countKP = 0, countKPS = 0, countKQ = 0;

  for (let i = 1; i <= 20; i++) {
    const selected = document.querySelector(`input[name="q${i}"]:checked`);
    if (!selected) {
      warning.textContent = "請完成所有題目後再計算。";
      return;
    }
    const val = parseInt(selected.value);

    if (i <= 9) { totalKP += val; countKP++; }
    else if (i <= 16) { totalKPS += val; countKPS++; }
    else { totalKQ += val; countKQ++; }
  }

  const scoreKP = Math.round(100 - (totalKP / (4 * countKP) * 100));
  const scoreKPS = Math.round(100 - (totalKPS / (4 * countKPS) * 100));
  const scoreKQ = Math.round(100 - (totalKQ / (4 * countKQ) * 100));

  document.getElementById("kpScore").innerHTML = `KOOS-KP（疼痛）：<strong>${scoreKP}</strong>`;
  document.getElementById("kpsScore").innerHTML = `KOOS-KPS（日常生活）：<strong>${scoreKPS}</strong>`;
  document.getElementById("kqScore").innerHTML = `KOOS-KQ（生活質量）：<strong>${scoreKQ}</strong>`;

  document.getElementById("scoreModal").style.display = "block";
}

function closeModal() {
  document.getElementById("scoreModal").style.display = "none";
}
</script>

</body>
</html>
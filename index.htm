<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>膝關節功能問卷（Chinese KOOS）</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <style>
    body {
      font-family: "Noto Sans TC", "Microsoft JhengHei", sans-serif;
      background: #f5f5f5;
      margin: 0;
      padding: 16px;
    }

    .container {
      max-width: 900px;
      margin: auto;
      background: #fff;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }

    h1 {
      text-align: center;
      margin-bottom: 12px;
    }

    h2 {
      margin-top: 24px;
      margin-bottom: 8px;
    }

    p.description {
      margin-bottom: 16px;
      color: #444;
      line-height: 1.5;
    }

    .question {
      margin-bottom: 16px;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 8px;
      background: #fafafa;
    }

    .question-title {
      font-weight: 600;
      margin-bottom: 8px;
    }

    .options {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }

    .option {
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 6px 10px;
      border-radius: 6px;
      background: #fff;
      border: 1px solid #ccc;
      cursor: pointer;
      font-size: 0.9rem;
    }

    .option input {
      cursor: pointer;
    }

    button {
      margin-top: 20px;
      padding: 12px 20px;
      border: none;
      border-radius: 6px;
      background: #1976d2;
      color: white;
      font-size: 1rem;
      cursor: pointer;
    }

    button:hover {
      background: #125a9c;
    }

    .warning {
      color: #c62828;
      margin-top: 10px;
      font-size: 0.9rem;
    }

    /* Modal */
    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      inset: 0;
      background: rgba(0,0,0,0.4);
    }

    .modal-content {
      background: #fff;
      margin: 15% auto;
      padding: 20px;
      border-radius: 10px;
      width: 90%;
      max-width: 420px;
      text-align: center;
      box-shadow: 0 2px 8px rgba(0,0,0,0.3);
    }

    .close-btn {
      margin-top: 15px;
      padding: 10px 16px;
      background: #555;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }

    .close-btn:hover {
      background: #333;
    }

    @media (max-width: 600px) {
      .options {
        flex-direction: column;
      }
      .option {
        width: 100%;
      }
    }
  </style>
</head>
<body>

<div class="container">
  <h1>膝關節功能問卷（Chinese KOOS）</h1>
  <p class="description">
    這個調查會詢問一些關於你的膝關節問題。請根據你過去一星期的情況，在每一題中選擇一個最合適的答案。
  </p>

  <!-- 第一部分：疼痛 -->
  <h2>第一部分：疼痛（KOOS-KP）</h2>

  <div class="question">
    <div class="question-title">1. 你多常感到膝痛？</div>
    <div class="options">
      <label class="option"><input type="radio" name="q1" value="0">從不</label>
      <label class="option"><input type="radio" name="q1" value="1">每月一次</label>
      <label class="option"><input type="radio" name="q1" value="2">每週一次</label>
      <label class="option"><input type="radio" name="q1" value="3">每日一次</label>
      <label class="option"><input type="radio" name="q1" value="4">經常</label>
    </div>
  </div>

  <p>過去一星期，你在進行以下活動時會感到什麼程度的疼痛？</p>

  <div id="questions"></div>

  <button onclick="calculateKOOS()">計算分數</button>
  <div id="warning" class="warning"></div>
</div>

<!-- Modal -->
<div id="scoreModal" class="modal">
  <div class="modal-content">
    <h2>膝關節問卷結果</h2>
    <p id="kpScore"></p>
    <p id="kpsScore"></p>
    <p id="kqScore"></p>
    <p style="font-size:0.9rem; color:#555;">
      0 分＝極度問題，100 分＝沒有問題。
    </p>
    <button class="close-btn" onclick="closeModal()">關閉</button>
  </div>
</div>

<script>
// Part 1 continued: pain items 2–9
const painItems = [
  "2. 以膝關節為中心扭動或轉動身體",
  "3. 完全伸直膝關節",
  "4. 完全曲膝關節",
  "5. 在平地步行",
  "6. 上或下樓梯",
  "7. 晚上睡",
  "8. 坐下或蹲下",
  "9. 挺直站立"
];

const painOptions = [
  "沒有疼痛",
  "輕微疼痛",
  "頗為疼痛",
  "非常疼痛",
  "極度疼痛"
];

// Part 2: daily living 1–7
const adlItems = [
  "第二部分：日常生活（KOOS-KPS）",
  "1. 起床",
  "2. 穿襪子／繫鞋",
  "3. 從坐姿站起",
  "4. 轉身至地／在地上撿起物品",
  "5. 轉動／扭動受傷的膝關節",
  "6. 跪下",
  "7. 蹲坐"
];

const adlOptions = [
  "沒有困難",
  "少許困難",
  "頗大困難",
  "非常困難",
  "極大困難"
];

// Part 3: QoL 1–4
const qolItems = [
  "第三部分：生活質量（KOOS-KQ）",
  "1. 你多常注意到你的膝關節問題？",
  "2. 你有否改變生活模式來避免一些有機會傷及膝關節的活動？",
  "3. 你是否對你的膝關節缺乏信心？",
  "4. 總括來說，你的膝關節對你的生活造成多大影響？"
];

const freqOptions = ["從不","每月一次","每星期一次","每日一次","經常"];
const changeOptions = ["沒有改變","少許改變","頗大改變","很大改變","完全改變"];
const confidenceOptions = ["完全沒有","少許","普通","嚴重","極度"];
const impactOptions = ["完全沒有","少許","頗大","非常大","極大"];

const questionsDiv = document.getElementById("questions");

// Render pain 2–9
painItems.forEach((text, index) => {
  const qNum = index + 2;
  const qDiv = document.createElement("div");
  qDiv.className = "question";

  const title = document.createElement("div");
  title.className = "question-title";
  title.textContent = text;
  qDiv.appendChild(title);

  const optionsDiv = document.createElement("div");
  optionsDiv.className = "options";

  for (let i = 0; i < 5; i++) {
    const label = document.createElement("label");
    label.className = "option";

    const input = document.createElement("input");
    input.type = "radio";
    input.name = `q${qNum}`;
    input.value = i;

    label.appendChild(input);
    label.appendChild(document.createTextNode(painOptions[i]));
    optionsDiv.appendChild(label);
  }

  qDiv.appendChild(optionsDiv);
  questionsDiv.appendChild(qDiv);
});

// Part 2 header
const adlHeader = document.createElement("h2");
adlHeader.textContent = adlItems[0];
questionsDiv.appendChild(adlHeader);

// Render ADL q10–q16
for (let idx = 1; idx <= 7; idx++) {
  const text = adlItems[idx];
  const qNum = 9 + idx;

  const qDiv = document.createElement("div");
  qDiv.className = "question";

  const title = document.createElement("div");
  title.className = "question-title";
  title.textContent = text;
  qDiv.appendChild(title);

  const optionsDiv = document.createElement("div");
  optionsDiv.className = "options";

  for (let i = 0; i < 5; i++) {
    const label = document.createElement("label");
    label.className = "option";

    const input = document.createElement("input");
    input.type = "radio";
    input.name = `q${qNum}`;
    input.value = i;

    label.appendChild(input);
    label.appendChild(document.createTextNode(adlOptions[i]));
    optionsDiv.appendChild(label);
  }

  qDiv.appendChild(optionsDiv);
  questionsDiv.appendChild(qDiv);
}

// Part 3 header
const qolHeader = document.createElement("h2");
qolHeader.textContent = qolItems[0];
questionsDiv.appendChild(qolHeader);

// QoL q17
(function () {
  const qDiv = document.createElement("div");
  qDiv.className = "question";
  const title = document.createElement("div");
  title.className = "question-title";
  title.textContent = qolItems[1];
  qDiv.appendChild(title);

  const optionsDiv = document.createElement("div");
  optionsDiv.className = "options";

  freqOptions.forEach((opt, i) => {
    const label = document.createElement("label");
    label.className = "option";
    const input = document.createElement("input");
    input.type = "radio";
    input.name = "q17";
    input.value = i;
    label.appendChild(input);
    label.appendChild(document.createTextNode(opt));
    optionsDiv.appendChild(label);
  });

  qDiv.appendChild(optionsDiv);
  questionsDiv.appendChild(qDiv);
})();

// QoL q18
(function () {
  const qDiv = document.createElement("div");
  qDiv.className = "question";
  const title = document.createElement("div");
  title.className = "question-title";
  title.textContent = qolItems[2];
  qDiv.appendChild(title);

  const optionsDiv = document.createElement("div");
  optionsDiv.className = "options";

  changeOptions.forEach((opt, i) => {
    const label = document.createElement("label");
    label.className = "option";
    const input = document.createElement("input");
    input.type = "radio";
    input.name = "q18";
    input.value = i;
    label.appendChild(input);
    label.appendChild(document.createTextNode(opt));
    optionsDiv.appendChild(label);
  });

  qDiv.appendChild(optionsDiv);
  questionsDiv.appendChild(qDiv);
})();

// QoL q19
(function () {
  const qDiv = document.createElement("div");
  qDiv.className = "question";
  const title = document.createElement("div");
  title.className = "question-title";
  title.textContent = qolItems[3];
  qDiv.appendChild(title);

  const optionsDiv = document.createElement("div");
  optionsDiv.className = "options";

  confidenceOptions.forEach((opt, i) => {
    const label = document.createElement("label");
    label.className = "option";
    const input = document.createElement("input");
    input.type = "radio";
    input.name = "q19";
    input.value = i;
    label.appendChild(input);
    label.appendChild(document.createTextNode(opt));
    optionsDiv.appendChild(label);
  });

  qDiv.appendChild(optionsDiv);
  questionsDiv.appendChild(qDiv);
})();

// QoL q20
(function () {
  const qDiv = document.createElement("div");
  qDiv.className = "question";
  const title = document.createElement("div");
  title.className = "question-title";
  title.textContent = qolItems[4];
  qDiv.appendChild(title);

  const optionsDiv = document.createElement("div");
  optionsDiv.className = "options";

  impactOptions.forEach((opt, i) => {
    const label = document.createElement("label");
    label.className = "option";
    const input = document.createElement("input");
    input.type = "radio";
    input.name = "q20";
    input.value = i;
    label.appendChild(input);
    label.appendChild(document.createTextNode(opt));
    optionsDiv.appendChild(label);
  });

  qDiv.appendChild(optionsDiv);
  questionsDiv.appendChild(qDiv);
})();

function calculateKOOS() {
  const warning = document.getElementById("warning");
  warning.textContent = "";

  let totalKP = 0, totalKPS = 0, totalKQ = 0;
  let countKP = 0, countKPS = 0, countKQ = 0;

  for (let i = 1; i <= 20; i++) {
    const selected = document.querySelector(`input[name="q${i}"]:checked`);
    if (!selected) {
      warning.textContent = "請完成所有題目後再按「計算分數」。";
      return;
    }
    const val = parseInt(selected.value);

    if (i <= 9) {
      totalKP += val;
      countKP++;
    } else if (i <= 16) {
      totalKPS += val;
      countKPS++;
    } else {
      totalKQ += val;
      countKQ++;
    }
  }

  const scoreKP = (100 - (totalKP / (4 * countKP) * 100)).toFixed(1);
  const scoreKPS = (100 - (totalKPS / (4 * countKPS) * 100)).toFixed(1);
  const scoreKQ = (100 - (totalKQ / (4 * countKQ) * 100)).toFixed(1);

  document.getElementById("kpScore").innerHTML = `KOOS-KP（疼痛）：<strong>${scoreKP}</strong>`;
  document.getElementById("kpsScore").innerHTML = `KOOS-KPS（日常生活）：<strong>${scoreKPS}</strong>`;
  document.getElementById("kqScore").innerHTML = `KOOS-KQ（生活質量）：<strong>${scoreKQ}</strong>`;

  document.getElementById("scoreModal").style.display = "block";
}

function closeModal() {
  document.getElementById("scoreModal").style.display = "none";
}
</script>

</body>
</html>
